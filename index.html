<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meus Investimentos</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 16px;
      background: #f4f4f4;
      overscroll-behavior-y: contain; /* ajuda no pull-to-refresh customizado */
    }
    h1 {
      font-size: 1.4rem;
      margin-bottom: 12px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      margin-bottom: 16px;
    }
    label {
      font-size: 0.85rem;
      display: block;
      margin-bottom: 4px;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 0.9rem;
      box-sizing: border-box;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 10px 16px;
      font-size: 0.9rem;
      cursor: pointer;
    }
    #addBtn {
      background: #0f766e;
      color: #fff;
      width: 100%;
      margin-top: 4px;
    }
    #addBtn:active {
      opacity: 0.8;
    }

    .secondary-btn {
      background: #e5e7eb;
      font-size: 0.8rem;
      padding: 8px 12px;
      border-radius: 999px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      min-width: 700px;
    }
    th, td {
      padding: 6px;
      text-align: left;
      border-bottom: 1px solid #eee;
      white-space: nowrap;
    }
    th {
      font-weight: 600;
    }
    .table-container {
      overflow-x: auto;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
    }
    .tipo-renda_fixa { background: #e0f2fe; }
    .tipo-fundo      { background: #fef9c3; }
    .tipo-cripto     { background: #fee2e2; }
    .tipo-acao       { background: #dcfce7; }

    .totais span {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 4px;
    }
    .danger-btn {
      background: #fee2e2;
      font-size: 0.7rem;
      padding: 4px 8px;
      border-radius: 999px;
    }

    /* Abas */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    .tab-btn {
      flex: 1;
      text-align: center;
      padding: 8px 0;
      border-radius: 999px;
      border: 1px solid #d4d4d8;
      background: #f4f4f5;
      font-size: 0.9rem;
    }
    .tab-btn.active {
      background: #0f766e;
      color: #fff;
      border-color: #0f766e;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }

    .status {
      font-size: 0.8rem;
      margin-bottom: 6px;
      color: #4b5563;
    }
    .status.error {
      color: #b91c1c;
    }
    .status.success {
      color: #15803d;
    }

    /* Mensagem visual do pull-to-refresh */
    #ptr-message {
      text-align: center;
      padding: 10px;
      font-size: 0.8rem;
      color: #6b7280;
      display: none;
    }
  </style>
</head>
<body>
  <!-- Mensagem do pull-to-refresh -->
  <div id="ptr-message">‚Üª Solte para atualizar a p√°gina...</div>

  <h1>Meus Investimentos</h1>

  <!-- Abas -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="cadastro">Cadastro</button>
    <button class="tab-btn" data-tab="lancamentos">Lan√ßamentos</button>
  </div>

  <!-- ABA CADASTRO -->
  <div id="tab-cadastro" class="tab-content active">
    <div class="card">
      <h2 style="font-size:1rem; margin-top:0;">Novo lan√ßamento</h2>

      <label for="tipo">Tipo</label>
      <select id="tipo">
        <option value="renda_fixa">Renda fixa</option>
        <option value="fundo">Fundo (FII/ETF/Fundo)</option>
        <option value="cripto">Criptoativo</option>
        <option value="acao">A√ß√£o</option>
      </select>

      <label for="ticker">Ticker / C√≥digo (para pre√ßo e valida√ß√£o)</label>
      <input id="ticker" placeholder="Ex.: PETR4, IVVB11, BTC, ETH..." />

      <label for="nome">Nome do ativo (deixa em branco para preencher autom√°tico)</label>
      <input id="nome" placeholder="Se vazio, usa o nome retornado pela API" />

      <label for="corretora">Corretora / Banco</label>
      <select id="corretora">
        <option value="Nubank">Nubank</option>
        <option value="XP">XP</option>
        <option value="BTG Pactual">BTG Pactual</option>
        <option value="Mercado Bitcoin">Mercado Bitcoin</option>
      </select>

      <label for="valor">Valor aplicado total (R$)</label>
      <input id="valor" type="number" step="0.01" inputmode="decimal" />

      <label for="quantidade">Quantidade de cotas/moedas</label>
      <input id="quantidade" type="number" step="0.0001" inputmode="decimal" />

      <label for="preco">Pre√ßo atual (R$) ‚Äì opcional, ser√° atualizado depois</label>
      <input id="preco" type="number" step="0.01" inputmode="decimal" />

      <button id="addBtn">Adicionar</button>
    </div>
  </div>

  <!-- ABA LAN√áAMENTOS -->
  <div id="tab-lancamentos" class="tab-content">
    <div class="card">
      <div class="status" id="status"></div>
      <button id="updatePricesBtn" class="secondary-btn">Atualizar pre√ßos de mercado</button>
    </div>

    <div class="card">
      <h2 style="font-size:1rem; margin-top:0;">Totais</h2>
      <div class="totais" id="totais"></div>
    </div>

    <div class="card">
      <h2 style="font-size:1rem; margin-top:0;">Lan√ßamentos</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Tipo</th>
              <th>Ticker</th>
              <th>Ativo</th>
              <th>Corretora</th>
              <th>Qtd</th>
              <th>Pre√ßo m√©dio</th>
              <th>Pre√ßo atual</th>
              <th>Aplicado</th>
              <th>Valor atual</th>
              <th>P/L %</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="lista"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Rodap√© com vers√£o da aplica√ß√£o -->
  <footer id="footerAtualizacao" style="
    text-align:center;
    font-size:0.75rem;
    color:#6b7280;
    margin-top:20px;
    padding-top:10px;
    border-top:1px solid #e5e7eb;
  ">
    √öltima vers√£o da aplica√ß√£o: carregando...
  </footer>

  <script>
  // üëç Ajuste aqui quando fizer uma nova vers√£o do app
  const APP_VERSION = "v0.3 ‚Äî 04/12/2025";
  const TAB_STORAGE_KEY = "meus_investimentos_tab";

  // üëç URL do SEU Worker (proxy Cloudflare)
  const PROXY_BASE_URL = "https://proxy-brapi.dionatan-sgs.workers.dev";

  // üëç Identifica√ß√£o do usu√°rio (multiusu√°rio)
  // Preencha com os dados retornados pela rota /admin/users do Worker
  const USER_ID  = "dionatan";               // id do usu√°rio
  const USER_KEY = "COLOQUE_AQUI_SUA_APIKEY"; // apiKey retornada ao criar usu√°rio

  const STORAGE_KEY = "meus_investimentos_v3";

  // carrega do localStorage (r√°pido, s√≥ pra n√£o ficar vazio)
  function carregarDadosLocal() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      return raw ? JSON.parse(raw) : [];
    } catch (e) {
      console.error(e);
      return [];
    }
  }

  // salva no localStorage
  function salvarDadosLocal(dados) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(dados));
  }

  // salva na nuvem (Worker + KV) ‚Äì n√£o precisa await em todo lugar
  async function salvarDadosNuvem(dados) {
    try {
      await fetch(
        `${PROXY_BASE_URL}/data?userId=${encodeURIComponent(
          USER_ID
        )}&userKey=${encodeURIComponent(USER_KEY)}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(dados),
        }
      );
    } catch (e) {
      console.error("Erro ao salvar na nuvem:", e);
    }
  }

  // fun√ß√£o central: salvar sempre local + nuvem
  function salvarDados(dados) {
    salvarDadosLocal(dados);
    // dispara a grava√ß√£o na nuvem em background
    salvarDadosNuvem(dados);
  }

  // inicialmente, carrega s√≥ do local (instant√¢neo)
  let investimentos = carregarDadosLocal();

  function formatCurrency(v) {
    if (v == null || isNaN(v)) return "-";
    return v.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
  }

  function formatPercent(v) {
    if (v == null || isNaN(v)) return "-";
    return v.toFixed(2).replace(".", ",") + " %";
  }

  function labelTipo(tipo) {
    switch (tipo) {
      case "renda_fixa":
        return "Renda fixa";
      case "fundo":
        return "Fundo";
      case "cripto":
        return "Cripto";
      case "acao":
        return "A√ß√£o";
      default:
        return tipo;
    }
  }

  function setStatus(msg, type = "") {
    const el = document.getElementById("status");
    el.textContent = msg || "";
    el.className = "status" + (type ? " " + type : "");
  }

  // Rodap√© com vers√£o da APLICA√á√ÉO (n√£o muda com os dados)
  function atualizarRodape() {
    const footer = document.getElementById("footerAtualizacao");
    footer.textContent = "√öltima vers√£o da aplica√ß√£o: " + APP_VERSION;
  }

  // MAPA CRIPTO (ticker -> {id, nome})
  const MAPA_CRIPTO = {
    BTC: { id: "bitcoin", nome: "Bitcoin" },
    ETH: { id: "ethereum", nome: "Ethereum" },
    SOL: { id: "solana", nome: "Solana" },
    ADA: { id: "cardano", nome: "Cardano" },
    XRP: { id: "ripple", nome: "XRP" },
    BNB: { id: "binancecoin", nome: "BNB" },
    // pode adicionar mais aqui
  };

  async function buscarPrecoCripto(ticker) {
    if (!ticker) return { preco: null, nomeApi: null, valido: false };

    const upper = ticker.toUpperCase().trim();
    const info = MAPA_CRIPTO[upper];
    if (!info) {
      return { preco: null, nomeApi: null, valido: false };
    }

    const url = `https://api.coingecko.com/api/v3/simple/price?ids=${encodeURIComponent(
      info.id
    )}&vs_currencies=brl`;
    try {
      const resp = await fetch(url);
      if (!resp.ok) {
        return { preco: null, nomeApi: info.nome, valido: false };
      }
      const data = await resp.json();
      const valor = data[info.id]?.brl;
      const preco = typeof valor === "number" ? valor : null;
      return {
        preco,
        nomeApi: info.nome,
        valido: true,
      };
    } catch (e) {
      console.error("Erro ao buscar cripto:", ticker, e);
      return { preco: null, nomeApi: info.nome, valido: false };
    }
  }

  // Busca a√ß√µes / fundos via proxy (Cloudflare Worker + brapi)
  async function buscarPrecoAcaoOuFundo(ticker) {
    if (!ticker) return { preco: null, nomeApi: null, valido: false };

    const clean = ticker.toUpperCase().trim();

    try {
      const url = `${PROXY_BASE_URL}/quote?symbol=${encodeURIComponent(clean)}`;
      const resp = await fetch(url);

      if (!resp.ok) {
        console.error("Erro no proxy:", resp.status);
        return { preco: null, nomeApi: null, valido: false };
      }

      const data = await resp.json();
      const r = data.results && data.results[0];

      if (!r || typeof r.regularMarketPrice !== "number") {
        return { preco: null, nomeApi: null, valido: false };
      }

      return {
        preco: r.regularMarketPrice,
        nomeApi: r.longName || r.shortName || clean,
        valido: true,
      };
    } catch (e) {
      console.error("Erro ao chamar proxy:", e);
      return { preco: null, nomeApi: null, valido: false };
    }
  }

  function render() {
    const tbody = document.getElementById("lista");
    tbody.innerHTML = "";

    const totais = {
      renda_fixa: { aplicado: 0, atual: 0 },
      fundo: { aplicado: 0, atual: 0 },
      cripto: { aplicado: 0, atual: 0 },
      acao: { aplicado: 0, atual: 0 },
    };

    investimentos.forEach((inv, index) => {
      const valorAplicado = inv.valor || 0;
      const quantidade = inv.quantidade || 0;
      const precoAtual = inv.preco || 0;

      const valorAtual =
        quantidade && precoAtual
          ? quantidade * precoAtual
          : precoAtual || valorAplicado;

      const precoMedio =
        quantidade && valorAplicado
          ? valorAplicado / quantidade
          : valorAplicado || null;

      const plValor = (valorAtual || 0) - (valorAplicado || 0);
      const plPercent = valorAplicado
        ? (plValor / valorAplicado) * 100
        : null;

      if (totais[inv.tipo]) {
        totais[inv.tipo].aplicado += valorAplicado;
        totais[inv.tipo].atual += valorAtual;
      }

      const tr = document.createElement("tr");

      const tdTipo = document.createElement("td");
      const span = document.createElement("span");
      span.textContent = labelTipo(inv.tipo);
      span.className = "badge tipo-" + inv.tipo;
      tdTipo.appendChild(span);

      const tdTicker = document.createElement("td");
      tdTicker.textContent = inv.ticker || "-";

      const tdNome = document.createElement("td");
      tdNome.textContent = inv.nome || "-";

      const tdCorretora = document.createElement("td");
      tdCorretora.textContent = inv.corretora || "-";

      const tdQtd = document.createElement("td");
      tdQtd.textContent = quantidade ? quantidade : "-";

      const tdPM = document.createElement("td");
      tdPM.textContent = formatCurrency(precoMedio);

      const tdPrecoAtual = document.createElement("td");
      tdPrecoAtual.textContent = formatCurrency(precoAtual);

      const tdAplicado = document.createElement("td");
      tdAplicado.textContent = formatCurrency(valorAplicado);

      const tdValorAtual = document.createElement("td");
      tdValorAtual.textContent = formatCurrency(valorAtual);

      const tdPL = document.createElement("td");
      tdPL.textContent = formatPercent(plPercent);

      const tdAcoes = document.createElement("td");
      const btnDel = document.createElement("button");
      btnDel.textContent = "Excluir";
      btnDel.className = "danger-btn";
      btnDel.onclick = () => {
        investimentos.splice(index, 1);
        salvarDados(investimentos);
        render();
      };
      tdAcoes.appendChild(btnDel);

      tr.appendChild(tdTipo);
      tr.appendChild(tdTicker);
      tr.appendChild(tdNome);
      tr.appendChild(tdCorretora);
      tr.appendChild(tdQtd);
      tr.appendChild(tdPM);
      tr.appendChild(tdPrecoAtual);
      tr.appendChild(tdAplicado);
      tr.appendChild(tdValorAtual);
      tr.appendChild(tdPL);
      tr.appendChild(tdAcoes);

      tbody.appendChild(tr);
    });

    const totaisDiv = document.getElementById("totais");
    totaisDiv.innerHTML = "";

    let totalCarteira = 0;

    Object.entries(totais).forEach(([tipo, obj]) => {
      if (obj.aplicado > 0 || obj.atual > 0) {
        const span = document.createElement("span");
        totalCarteira += obj.atual;
        const plTipo = obj.aplicado
          ? ((obj.atual - obj.aplicado) / obj.aplicado) * 100
          : null;

        span.textContent = `${labelTipo(tipo)} | Aplicado: ${formatCurrency(
          obj.aplicado
        )} | Atual: ${formatCurrency(obj.atual)} | P/L: ${formatPercent(
          plTipo
        )}`;
        totaisDiv.appendChild(span);
      }
    });

    if (totalCarteira > 0) {
      const spanTotal = document.createElement("span");
      spanTotal.style.marginTop = "6px";
      spanTotal.style.fontWeight = "600";
      spanTotal.textContent =
        "Total da carteira (valor atual): " + formatCurrency(totalCarteira);
      totaisDiv.appendChild(spanTotal);
    }
  }

  async function validarTicker(tipo, ticker) {
    const upper = ticker.toUpperCase().trim();
    if (
      !upper &&
      (tipo === "acao" || tipo === "fundo" || tipo === "cripto")
    ) {
      return {
        valido: false,
        msg: "Informe um ticker para esse tipo de ativo.",
      };
    }

    if (tipo === "cripto") {
      const info = MAPA_CRIPTO[upper];
      if (!info) {
        return {
          valido: false,
          msg: "Ticker de cripto n√£o mapeado. Adicione no c√≥digo ou corrija o ticker.",
        };
      }
      const res = await buscarPrecoCripto(upper);
      if (!res.valido) {
        return {
          valido: false,
          msg: "N√£o foi poss√≠vel validar o ticker de cripto. Verifique o c√≥digo.",
        };
      }
      return {
        valido: true,
        preco: res.preco,
        nomeApi: res.nomeApi,
      };
    }

    if (tipo === "acao" || tipo === "fundo") {
      const res = await buscarPrecoAcaoOuFundo(upper);
      if (!res.valido) {
        return {
          valido: false,
          msg: "Ticker de a√ß√£o/fundo n√£o encontrado. Verifique o c√≥digo (ex.: PETR4, IVVB11, JURO11).",
        };
      }
      return {
        valido: true,
        preco: res.preco,
        nomeApi: res.nomeApi,
      };
    }

    // Renda fixa: ticker opcional, n√£o valida
    return { valido: true, preco: null, nomeApi: null };
  }

  document.getElementById("addBtn").addEventListener("click", async () => {
    const tipo = document.getElementById("tipo").value;
    const ticker = document.getElementById("ticker").value.trim();
    let nome = document.getElementById("nome").value.trim();
    const corretora = document.getElementById("corretora").value;
    const valor = parseFloat(
      document.getElementById("valor").value.replace(",", ".")
    );
    const quantidadeRaw = document
      .getElementById("quantidade")
      .value.replace(",", ".");
    const precoRaw = document
      .getElementById("preco")
      .value.replace(",", ".");
    let quantidade = quantidadeRaw ? parseFloat(quantidadeRaw) : null;
    let preco = precoRaw ? parseFloat(precoRaw) : null;

    if (!valor || isNaN(valor)) {
      alert("Informe o valor aplicado total.");
      return;
    }

    if (
      (tipo === "acao" || tipo === "fundo" || tipo === "cripto") &&
      (!quantidade || isNaN(quantidade))
    ) {
      alert("Para a√ß√µes, fundos e cripto informe a quantidade.");
      return;
    }

    setStatus("Validando ticker...", "");

    const valida = await validarTicker(tipo, ticker);
    if (!valida.valido) {
      alert(
        valida.msg || "Erro ao validar o ticker. Verifique o c√≥digo informado."
      );
      setStatus(
        valida.msg || "Erro ao validar o ticker.",
        "error"
      );
      return;
    }

    // Se a API trouxe nome e o campo nome estiver vazio, preenche autom√°tico
    if (!nome && valida.nomeApi) {
      nome = valida.nomeApi;
    }

    // Se a API trouxe pre√ßo e o campo pre√ßo estiver vazio, usa o da API
    if (!preco && valida.preco) {
      preco = valida.preco;
    }

    // Se quantidade n√£o foi informada para renda fixa, define como 1
    if ((!quantidade || isNaN(quantidade)) && tipo === "renda_fixa") {
      quantidade = 1;
    }

    investimentos.push({
      tipo,
      ticker: ticker || null,
      nome: nome || ticker || "",
      corretora,
      valor,
      quantidade,
      preco,
      criadoEm: new Date().toISOString(),
    });

    salvarDados(investimentos);

    // Pop-up de confirma√ß√£o
    alert("Lan√ßamento adicionado com sucesso!");

    // Limpar campos
    document.getElementById("ticker").value = "";
    document.getElementById("nome").value = "";
    document.getElementById("valor").value = "";
    document.getElementById("quantidade").value = "";
    document.getElementById("preco").value = "";

    render();
    setStatus("Lan√ßamento adicionado com sucesso.", "success");
  });

  async function atualizarPrecosMercado() {
    if (!investimentos.length) {
      setStatus("Nenhum investimento para atualizar.", "");
      return;
    }

    setStatus("Atualizando pre√ßos de mercado...", "");

    let atualizados = 0;

    for (let inv of investimentos) {
      if (!inv.ticker) continue;

      if (inv.tipo === "cripto") {
        const res = await buscarPrecoCripto(inv.ticker);
        if (res.valido && res.preco != null) {
          inv.preco = res.preco;
          if (!inv.nome && res.nomeApi) {
            inv.nome = res.nomeApi;
          }
          atualizados++;
        }
      } else if (inv.tipo === "acao" || inv.tipo === "fundo") {
        const res = await buscarPrecoAcaoOuFundo(inv.ticker);
        if (res.valido && res.preco != null) {
          inv.preco = res.preco;
          if (!inv.nome && res.nomeApi) {
            inv.nome = res.nomeApi;
          }
          atualizados++;
        }
      } else {
        continue;
      }
    }

    salvarDados(investimentos);
    render();

    if (atualizados > 0) {
      setStatus(
        `Pre√ßos atualizados para ${atualizados} ativo(s).`,
        "success"
      );
    } else {
      setStatus(
        "N√£o foi poss√≠vel atualizar os pre√ßos. Verifique tickers ou tente novamente depois.",
        "error"
      );
    }
  }

  document
    .getElementById("updatePricesBtn")
    .addEventListener("click", () => {
      atualizarPrecosMercado();
    });

  function setActiveTab(tab) {
    // Bot√µes
    document.querySelectorAll(".tab-btn").forEach((b) => {
      const bTab = b.getAttribute("data-tab");
      if (bTab === tab) {
        b.classList.add("active");
      } else {
        b.classList.remove("active");
      }
    });

    // Conte√∫dos
    document.querySelectorAll(".tab-content").forEach((c) => {
      if (c.id === "tab-" + tab) {
        c.classList.add("active");
      } else {
        c.classList.remove("active");
      }
    });

    // Salva aba atual
    try {
      localStorage.setItem(TAB_STORAGE_KEY, tab);
    } catch (e) {
      console.warn("N√£o foi poss√≠vel salvar aba atual:", e);
    }
  }

  // L√≥gica das abas
  document.querySelectorAll(".tab-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const tab = btn.getAttribute("data-tab");
      setActiveTab(tab);
    });
  });

  // Ao carregar a p√°gina, restaura a √∫ltima aba usada
  let abaSalva = "cadastro";
  try {
    const stored = localStorage.getItem(TAB_STORAGE_KEY);
    if (stored === "cadastro" || stored === "lancamentos") {
      abaSalva = stored;
    }
  } catch (e) {
    console.warn("N√£o foi poss√≠vel ler aba salva:", e);
  }
  setActiveTab(abaSalva);

  // Render inicial + vers√£o no rodap√©
  render();
  atualizarRodape();

  // Depois de renderizar com o que tem localmente,
  // tenta sincronizar com a nuvem (se houver dados l√°).
  async function sincronizarComNuvemAoAbrir() {
    try {
      const resp = await fetch(
        `${PROXY_BASE_URL}/data?userId=${encodeURIComponent(
          USER_ID
        )}&userKey=${encodeURIComponent(USER_KEY)}`
      );
      if (!resp.ok) {
        console.error("Falha ao carregar da nuvem:", resp.status);
        return;
      }
      const json = await resp.json();
      if (Array.isArray(json.data)) {
        investimentos = json.data;
        salvarDadosLocal(investimentos); // cache local atualizado
        render();
        setStatus("Dados sincronizados da nuvem.", "success");
      }
    } catch (e) {
      console.error("Erro ao sincronizar com a nuvem:", e);
    }
  }

  // chama a sincroniza√ß√£o inicial
  sincronizarComNuvemAoAbrir();

  // PULL TO REFRESH (arrastar para baixo para recarregar a p√°gina)
  let startY = 0;
  let puxando = false;
  const mensagemPTR = document.getElementById("ptr-message");

  window.addEventListener("touchstart", (e) => {
    if (window.scrollY === 0) {
      startY = e.touches[0].clientY;
      puxando = true;
    }
  });

  window.addEventListener("touchmove", (e) => {
    if (!puxando) return;

    const atualY = e.touches[0].clientY;
    const distancia = atualY - startY;

    if (distancia > 50) {
      mensagemPTR.style.display = "block";
    } else {
      mensagemPTR.style.display = "none";
    }
  });

  window.addEventListener("touchend", (e) => {
    if (!puxando) return;
    puxando = false;

    const endY = e.changedTouches[0].clientY;
    const distancia = endY - startY;

    mensagemPTR.style.display = "none";

    if (distancia > 80) {
      // Recarrega a p√°gina; ao recarregar, vers√£o continua a mesma (APP_VERSION)
      location.reload();
    }
  });
</script>
</body>
</html>
